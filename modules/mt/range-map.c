#include <stdlib.h>
#include <stdio.h>
#include <pthread.h>
#include <unistd.h>
#include <string.h>

#include "public/esq.h"
#include "public/libesq.h"
#include "public/esqll.h"
#include "internal/types.h"
#include "internal/threads.h"
#include "internal/range_map.h"
#include "internal/monkeycall.h"
#include "modules/mt/internal.h"

typedef struct _rm_test_t	{
	const char * cfg;
	int r;
	const char * dump;
} rm_test_t;

typedef struct _rm_test_t2	{
	char * hash_string;
	int has_hash;
	const char * list_string;
} rm_test_t2;

static rm_test_t t[] = {
	{	/* 0 */
		"RangeMapDelAllNode(\"kcdb\");",
		0,
		"",
	},
	{	/* 1 */
		"RangeMapAddNode(\"kcdb\", \"127.0.0.1\", 2000, 0, \"x\");RangeMapFlush(\"kcdb\");",
		0,
		"0: 127.0.0.1:2000:x",
	},
	{	/* 2 */
		"RangeMapDelAllNode(\"kcdb\");",
		0,
		"",
	},
	{	/* 3 */
		"RangeMapDelAllNode(\"kcdb\");RangeMapAddNode(\"kcdb\", \"127.0.0.1\", 2000, 0, \"aax\");RangeMapAddNode(\"kcdb\", \"127.0.0.1\", 2000, 0, \"bbx\");RangeMapAddNode(\"kcdb\", \"127.0.0.1\", 2000, 0, \"00x\");RangeMapFlush(\"kcdb\");",
		0,
		"1: 127.0.0.1:2000:00x, 1: 127.0.0.1:2000:aax, 1: 127.0.0.1:2000:bbx",
	},
	{	/* 4 */
		"RangeMapDelAllNode(\"kcdb\");RangeMapAddNode(\"kcdb\", \"127.0.0.1\", 2000, 0, \"aax\");RangeMapFlush(\"kcdb\");RangeMapAddNode(\"kcdb\", \"127.0.0.1\", 2000, 0, \"bbx\");RangeMapFlush(\"kcdb\");RangeMapAddNode(\"kcdb\", \"127.0.0.1\", 2000, 0, \"00x\");RangeMapFlush(\"kcdb\");",
		0,
		"1: 127.0.0.1:2000:00x, 1: 127.0.0.1:2000:aax, 1: 127.0.0.1:2000:bbx",
	},
	{	/* 5 */
		"RangeMapDelAllNode(\"kcdb\");RangeMapAddNode(\"kcdb\", \"127.0.0.1\", 2001, 0, \"x\");RangeMapAddNode(\"kcdb\", \"127.0.0.1\", 2000, 0, \"aax\");RangeMapFlush(\"kcdb\");RangeMapAddNode(\"kcdb\", \"127.0.0.1\", 2000, 0, \"bbx\");RangeMapFlush(\"kcdb\");RangeMapAddNode(\"kcdb\", \"127.0.0.1\", 2000, 0, \"00x\");RangeMapFlush(\"kcdb\");",
		0,
		"0: 127.0.0.1:2001:x, 1: 127.0.0.1:2000:00x 127.0.0.1:2001:x, 1: 127.0.0.1:2000:aax 127.0.0.1:2001:x, 1: 127.0.0.1:2000:bbx 127.0.0.1:2001:x",
	},
	{	/* 6 */
		"RangeMapDelAllNode(\"kcdb\");RangeMapAddNode(\"kcdb\", \"127.0.0.1\", 2001, 0, \"x\");RangeMapAddNode(\"kcdb\", \"127.0.0.1\", 2000, 0, \"aax\");RangeMapFlush(\"kcdb\");RangeMapAddNode(\"kcdb\", \"127.0.0.1\", 2008, 0, \"x\");RangeMapAddNode(\"kcdb\", \"127.0.0.1\", 2000, 0, \"bbx\");RangeMapFlush(\"kcdb\");RangeMapAddNode(\"kcdb\", \"127.0.0.1\", 2000, 0, \"00x\");RangeMapFlush(\"kcdb\");",
		0,
		"0: 127.0.0.1:2008:x 127.0.0.1:2001:x, 1: 127.0.0.1:2000:00x 127.0.0.1:2008:x 127.0.0.1:2001:x, 1: 127.0.0.1:2000:aax 127.0.0.1:2008:x 127.0.0.1:2001:x, 1: 127.0.0.1:2000:bbx 127.0.0.1:2008:x 127.0.0.1:2001:x",
	},
	{	/* 7 */
		"RangeMapDelAllNode(\"kcdb\");",
		0,
		"",
	},
	/* -- */
	{	/* 8 */
		"RangeMapAddNode(\"kcdb\", \"127.0.0.1\", 2000, 0, \"x\");RangeMapAddNode(\"kcdb\", \"127.0.0.1\", 2001, 0, \"x\");RangeMapFlush(\"kcdb\");",
		0,
		"0: 127.0.0.1:2001:x 127.0.0.1:2000:x",
	},
	{	/* 9 */
		"RangeMapAddNode(\"kcdb\", \"127.0.0.1\", 2000, 0, \"aax\");RangeMapAddNode(\"kcdb\", \"127.0.0.1\", 2001, 0, \"aax\");RangeMapFlush(\"kcdb\");",
		0,
		"0: 127.0.0.1:2001:x 127.0.0.1:2000:x, 1: 127.0.0.1:2001:aax 127.0.0.1:2000:aax 127.0.0.1:2001:x 127.0.0.1:2000:x",
	},
	{	/* 10 */
		"RangeMapAddNode(\"kcdb\", \"127.0.0.1\", 2000, 0, \"bbx\");RangeMapAddNode(\"kcdb\", \"127.0.0.1\", 2001, 0, \"bbx\");RangeMapFlush(\"kcdb\");",
		0,
		"0: 127.0.0.1:2001:x 127.0.0.1:2000:x, 1: 127.0.0.1:2001:aax 127.0.0.1:2000:aax 127.0.0.1:2001:x 127.0.0.1:2000:x, 1: 127.0.0.1:2001:bbx 127.0.0.1:2000:bbx 127.0.0.1:2001:x 127.0.0.1:2000:x",
	},
	{	/* 11 */
		"RangeMapAddNode(\"kcdb\", \"127.0.0.1\", 2000, 0, \"00x\");RangeMapAddNode(\"kcdb\", \"127.0.0.1\", 2001, 0, \"00x\");RangeMapFlush(\"kcdb\");",
		0,
		"0: 127.0.0.1:2001:x 127.0.0.1:2000:x, 1: 127.0.0.1:2001:00x 127.0.0.1:2000:00x 127.0.0.1:2001:x 127.0.0.1:2000:x, 1: 127.0.0.1:2001:aax 127.0.0.1:2000:aax 127.0.0.1:2001:x 127.0.0.1:2000:x, 1: 127.0.0.1:2001:bbx 127.0.0.1:2000:bbx 127.0.0.1:2001:x 127.0.0.1:2000:x",
	},
	/* -- */
	{	/* 12 */
		"RangeMapDelAllNode(\"kcdb\");"
		"RangeMapAddNode(\"kcdb\", \"127.0.0.1\", 2000, 0, \"x\");RangeMapAddNode(\"kcdb\", \"127.0.0.1\", 2001, 0, \"x\");"
		"RangeMapAddNode(\"kcdb\", \"127.0.0.1\", 2000, 0, \"aax\");RangeMapAddNode(\"kcdb\", \"127.0.0.1\", 2001, 0, \"aax\");"
		"RangeMapAddNode(\"kcdb\", \"127.0.0.1\", 2000, 0, \"bbx\");RangeMapAddNode(\"kcdb\", \"127.0.0.1\", 2001, 0, \"bbx\");"
		"RangeMapAddNode(\"kcdb\", \"127.0.0.1\", 2000, 0, \"00x\");RangeMapAddNode(\"kcdb\", \"127.0.0.1\", 2001, 0, \"00x\");"
		"RangeMapFlush(\"kcdb\");",
		0,
		"0: 127.0.0.1:2001:x 127.0.0.1:2000:x, 1: 127.0.0.1:2001:00x 127.0.0.1:2000:00x 127.0.0.1:2001:x 127.0.0.1:2000:x, 1: 127.0.0.1:2001:aax 127.0.0.1:2000:aax 127.0.0.1:2001:x 127.0.0.1:2000:x, 1: 127.0.0.1:2001:bbx 127.0.0.1:2000:bbx 127.0.0.1:2001:x 127.0.0.1:2000:x",
	},
	{	/* 13 */
		"RangeMapDelAllNode(\"kcdb\");"
		"RangeMapAddNode(\"kcdb\", \"127.0.0.1\", 2000, 0, \"x\");"
		"RangeMapAddNode(\"kcdb\", \"127.0.0.1\", 2000, 0, \"00x\");"
		"RangeMapFlush(\"kcdb\");",
		0,
		"0: 127.0.0.1:2000:x, 1: 127.0.0.1:2000:00x 127.0.0.1:2000:x",
	},
	{	/* 14 */
		"RangeMapDelAllNode(\"kcdb\");"
		"RangeMapAddNode(\"kcdb\", \"127.0.0.1\", 2000, 0, \"x\");RangeMapAddNode(\"kcdb\", \"127.0.0.1\", 2001, 0, \"x\");"
		"RangeMapAddNode(\"kcdb\", \"127.0.0.1\", 2000, 0, \"aax\");RangeMapAddNode(\"kcdb\", \"127.0.0.1\", 2001, 0, \"aax\");"
		"RangeMapAddNode(\"kcdb\", \"127.0.0.1\", 2000, 0, \"bbx\");RangeMapAddNode(\"kcdb\", \"127.0.0.1\", 2001, 0, \"bbx\");"
		"RangeMapAddNode(\"kcdb\", \"127.0.0.1\", 2000, 0, \"00x\");RangeMapAddNode(\"kcdb\", \"127.0.0.1\", 2001, 0, \"00x\");"
		"RangeMapAddNode(\"kcdb\", \"127.0.0.1\", 2000, 0, \"123456x\");RangeMapAddNode(\"kcdb\", \"127.0.0.1\", 2001, 0, \"123456x\");"
		"RangeMapAddNode(\"kcdb\", \"127.0.0.1\", 2000, 0, \"123456789ax\");RangeMapAddNode(\"kcdb\", \"127.0.0.1\", 2001, 0, \"123456789ax\");"
		"RangeMapFlush(\"kcdb\");",
		0,
		"0: 127.0.0.1:2001:x 127.0.0.1:2000:x, "
		"1: 127.0.0.1:2001:00x 127.0.0.1:2000:00x 127.0.0.1:2001:x 127.0.0.1:2000:x, "
		"1: 127.0.0.1:2001:aax 127.0.0.1:2000:aax 127.0.0.1:2001:x 127.0.0.1:2000:x, "
		"1: 127.0.0.1:2001:bbx 127.0.0.1:2000:bbx 127.0.0.1:2001:x 127.0.0.1:2000:x, "
		"3: 127.0.0.1:2001:123456x 127.0.0.1:2000:123456x 127.0.0.1:2001:x 127.0.0.1:2000:x, "
		"5: 127.0.0.1:2001:123456789ax 127.0.0.1:2000:123456789ax 127.0.0.1:2001:123456x 127.0.0.1:2000:123456x 127.0.0.1:2001:x 127.0.0.1:2000:x",
	},
	{	/* 15 */
		"RangeMapDelNode(\"kcdb\", \"127.0.0.1\", 2000, \"aax\");",
		0,
		"0: 127.0.0.1:2001:x 127.0.0.1:2000:x, "
		"1: 127.0.0.1:2001:00x 127.0.0.1:2000:00x 127.0.0.1:2001:x 127.0.0.1:2000:x, "
		"1: 127.0.0.1:2001:aax 127.0.0.1:2001:x 127.0.0.1:2000:x, "
		"1: 127.0.0.1:2001:bbx 127.0.0.1:2000:bbx 127.0.0.1:2001:x 127.0.0.1:2000:x, "
		"3: 127.0.0.1:2001:123456x 127.0.0.1:2000:123456x 127.0.0.1:2001:x 127.0.0.1:2000:x, "
		"5: 127.0.0.1:2001:123456789ax 127.0.0.1:2000:123456789ax 127.0.0.1:2001:123456x 127.0.0.1:2000:123456x 127.0.0.1:2001:x 127.0.0.1:2000:x",
	},
	{	/* 16 */
		"RangeMapDelNode(\"kcdb\", \"127.0.0.1\", 2000, \"x\");",
		0,
		"0: 127.0.0.1:2001:x, "
		"1: 127.0.0.1:2001:00x 127.0.0.1:2000:00x 127.0.0.1:2001:x, "
		"1: 127.0.0.1:2001:aax 127.0.0.1:2001:x, "
		"1: 127.0.0.1:2001:bbx 127.0.0.1:2000:bbx 127.0.0.1:2001:x, "
		"3: 127.0.0.1:2001:123456x 127.0.0.1:2000:123456x 127.0.0.1:2001:x, "
		"5: 127.0.0.1:2001:123456789ax 127.0.0.1:2000:123456789ax 127.0.0.1:2001:123456x 127.0.0.1:2000:123456x 127.0.0.1:2001:x",
	},
	{	/* 17 */
		"RangeMapDelNode(\"kcdb\", \"127.0.0.1\", 2001, \"x\");",
		0,
		"1: 127.0.0.1:2001:00x 127.0.0.1:2000:00x, "
		"1: 127.0.0.1:2001:aax, "
		"1: 127.0.0.1:2001:bbx 127.0.0.1:2000:bbx, "
		"3: 127.0.0.1:2001:123456x 127.0.0.1:2000:123456x, "
		"5: 127.0.0.1:2001:123456789ax 127.0.0.1:2000:123456789ax 127.0.0.1:2001:123456x 127.0.0.1:2000:123456x",
	},
	{	/* 18 */
		"RangeMapAddNode(\"kcdb\", \"127.0.0.1\", 2000, 0, \"aax\");"
		"RangeMapAddNode(\"kcdb\", \"127.0.0.1\", 2001, 0, \"x\");"
		"RangeMapAddNode(\"kcdb\", \"127.0.0.1\", 2000, 0, \"x\");"
		"RangeMapFlush(\"kcdb\");",
		0,
		"0: 127.0.0.1:2000:x 127.0.0.1:2001:x, "
		"1: 127.0.0.1:2001:00x 127.0.0.1:2000:00x 127.0.0.1:2000:x 127.0.0.1:2001:x, "
		"1: 127.0.0.1:2000:aax 127.0.0.1:2001:aax 127.0.0.1:2000:x 127.0.0.1:2001:x, "
		"1: 127.0.0.1:2001:bbx 127.0.0.1:2000:bbx 127.0.0.1:2000:x 127.0.0.1:2001:x, "
		"3: 127.0.0.1:2001:123456x 127.0.0.1:2000:123456x 127.0.0.1:2000:x 127.0.0.1:2001:x, "
		"5: 127.0.0.1:2001:123456789ax 127.0.0.1:2000:123456789ax 127.0.0.1:2001:123456x 127.0.0.1:2000:123456x 127.0.0.1:2000:x 127.0.0.1:2001:x",
	},
	{	/* 19 */
		"RangeMapDelNode(\"kcdb\", \"127.0.0.1\", 2000, \"aax\");",
		0,
		"0: 127.0.0.1:2000:x 127.0.0.1:2001:x, "
		"1: 127.0.0.1:2001:00x 127.0.0.1:2000:00x 127.0.0.1:2000:x 127.0.0.1:2001:x, "
		"1: 127.0.0.1:2001:aax 127.0.0.1:2000:x 127.0.0.1:2001:x, "
		"1: 127.0.0.1:2001:bbx 127.0.0.1:2000:bbx 127.0.0.1:2000:x 127.0.0.1:2001:x, "
		"3: 127.0.0.1:2001:123456x 127.0.0.1:2000:123456x 127.0.0.1:2000:x 127.0.0.1:2001:x, "
		"5: 127.0.0.1:2001:123456789ax 127.0.0.1:2000:123456789ax 127.0.0.1:2001:123456x 127.0.0.1:2000:123456x 127.0.0.1:2000:x 127.0.0.1:2001:x",
	},
	{	/* 20 */
		"RangeMapDelNode(\"kcdb\", \"127.0.0.1\", 2001, \"aax\");",
		0,
		"0: 127.0.0.1:2000:x 127.0.0.1:2001:x, "
		"1: 127.0.0.1:2001:00x 127.0.0.1:2000:00x 127.0.0.1:2000:x 127.0.0.1:2001:x, "
		"1: 127.0.0.1:2001:bbx 127.0.0.1:2000:bbx 127.0.0.1:2000:x 127.0.0.1:2001:x, "
		"3: 127.0.0.1:2001:123456x 127.0.0.1:2000:123456x 127.0.0.1:2000:x 127.0.0.1:2001:x, "
		"5: 127.0.0.1:2001:123456789ax 127.0.0.1:2000:123456789ax 127.0.0.1:2001:123456x 127.0.0.1:2000:123456x 127.0.0.1:2000:x 127.0.0.1:2001:x",
	},
	{	/* 21 */
		"RangeMapDelNode(\"kcdb\", \"127.0.0.1\", 2001, \"x\");",
		0,
		"0: 127.0.0.1:2000:x, "
		"1: 127.0.0.1:2001:00x 127.0.0.1:2000:00x 127.0.0.1:2000:x, "
		"1: 127.0.0.1:2001:bbx 127.0.0.1:2000:bbx 127.0.0.1:2000:x, "
		"3: 127.0.0.1:2001:123456x 127.0.0.1:2000:123456x 127.0.0.1:2000:x, "
		"5: 127.0.0.1:2001:123456789ax 127.0.0.1:2000:123456789ax 127.0.0.1:2001:123456x 127.0.0.1:2000:123456x 127.0.0.1:2000:x",
	},
	{	/* 22 */
		"RangeMapDelNode(\"kcdb\", \"127.0.0.1\", 2001, \"00x\");",
		0,
		"0: 127.0.0.1:2000:x, "
		"1: 127.0.0.1:2000:00x 127.0.0.1:2000:x, "
		"1: 127.0.0.1:2001:bbx 127.0.0.1:2000:bbx 127.0.0.1:2000:x, "
		"3: 127.0.0.1:2001:123456x 127.0.0.1:2000:123456x 127.0.0.1:2000:x, "
		"5: 127.0.0.1:2001:123456789ax 127.0.0.1:2000:123456789ax 127.0.0.1:2001:123456x 127.0.0.1:2000:123456x 127.0.0.1:2000:x",
	},
	{	/* 23 */
		"RangeMapDelNode(\"kcdb\", \"127.0.0.1\", 2001, \"123456x\");",
		0,
		"0: 127.0.0.1:2000:x, "
		"1: 127.0.0.1:2000:00x 127.0.0.1:2000:x, "
		"1: 127.0.0.1:2001:bbx 127.0.0.1:2000:bbx 127.0.0.1:2000:x, "
		"3: 127.0.0.1:2000:123456x 127.0.0.1:2000:x, "
		"5: 127.0.0.1:2001:123456789ax 127.0.0.1:2000:123456789ax 127.0.0.1:2000:123456x 127.0.0.1:2000:x",
	},
	{	/* 24 */
		"RangeMapDelNode(\"kcdb\", \"127.0.0.1\", 2000, \"123456x\");",
		0,
		"0: 127.0.0.1:2000:x, "
		"1: 127.0.0.1:2000:00x 127.0.0.1:2000:x, "
		"1: 127.0.0.1:2001:bbx 127.0.0.1:2000:bbx 127.0.0.1:2000:x, "
		"5: 127.0.0.1:2001:123456789ax 127.0.0.1:2000:123456789ax 127.0.0.1:2000:x",
	},
	{	/* 25 */
		"RangeMapDelNode(\"kcdb\", \"127.0.0.1\", 2000, \"123456789ax\");",
		0,
		"0: 127.0.0.1:2000:x, "
		"1: 127.0.0.1:2000:00x 127.0.0.1:2000:x, "
		"1: 127.0.0.1:2001:bbx 127.0.0.1:2000:bbx 127.0.0.1:2000:x, "
		"5: 127.0.0.1:2001:123456789ax 127.0.0.1:2000:x",
	},
	{	/* 26 */
		"RangeMapDelNode(\"kcdb\", \"127.0.0.1\", 2000, \"x\");",
		0,
		"1: 127.0.0.1:2000:00x, "
		"1: 127.0.0.1:2001:bbx 127.0.0.1:2000:bbx, "
		"5: 127.0.0.1:2001:123456789ax",
	},
	{	/* 27 */
		"RangeMapDelNode(\"kcdb\", \"127.0.0.1\", 2000, \"bbx\");",
		0,
		"1: 127.0.0.1:2000:00x, "
		"1: 127.0.0.1:2001:bbx, "
		"5: 127.0.0.1:2001:123456789ax",
	},
	{	/* 28 */
		"RangeMapDelNode(\"kcdb\", \"127.0.0.1\", 2000, \"00x\");",
		0,
		"1: 127.0.0.1:2001:bbx, "
		"5: 127.0.0.1:2001:123456789ax",
	},
	{	/* 29 */
		"RangeMapDelNode(\"kcdb\", \"127.0.0.1\", 2001, \"bbx\");"
		"RangeMapDelNode(\"kcdb\", \"127.0.0.1\", 2001, \"123456789ax\");",
		0,
		"",
	},
	{	/* -- */
		"RangeMapDelAllNode(\"kcdb\");"
		"RangeMapAddNode(\"kcdb\", \"127.0.0.1\", 2000, 0, \"x\");RangeMapAddNode(\"kcdb\", \"127.0.0.1\", 2001, 0, \"x\");"
		"RangeMapAddNode(\"kcdb\", \"127.0.0.1\", 2000, 0, \"aax\");RangeMapAddNode(\"kcdb\", \"127.0.0.1\", 2001, 0, \"aax\");"
		"RangeMapAddNode(\"kcdb\", \"127.0.0.1\", 2000, 0, \"bbx\");RangeMapAddNode(\"kcdb\", \"127.0.0.1\", 2001, 0, \"bbx\");"
		"RangeMapAddNode(\"kcdb\", \"127.0.0.1\", 2000, 0, \"00x\");RangeMapAddNode(\"kcdb\", \"127.0.0.1\", 2001, 0, \"00x\");"
		"RangeMapAddNode(\"kcdb\", \"127.0.0.1\", 2000, 0, \"123456x\");RangeMapAddNode(\"kcdb\", \"127.0.0.1\", 2001, 0, \"123456x\");"
		"RangeMapAddNode(\"kcdb\", \"127.0.0.1\", 2000, 0, \"123456789ax\");RangeMapAddNode(\"kcdb\", \"127.0.0.1\", 2001, 0, \"123456789ax\");"
		"RangeMapFlush(\"kcdb\");",
		0,
		"0: 127.0.0.1:2001:x 127.0.0.1:2000:x, "
		"1: 127.0.0.1:2001:00x 127.0.0.1:2000:00x 127.0.0.1:2001:x 127.0.0.1:2000:x, "
		"1: 127.0.0.1:2001:aax 127.0.0.1:2000:aax 127.0.0.1:2001:x 127.0.0.1:2000:x, "
		"1: 127.0.0.1:2001:bbx 127.0.0.1:2000:bbx 127.0.0.1:2001:x 127.0.0.1:2000:x, "
		"3: 127.0.0.1:2001:123456x 127.0.0.1:2000:123456x 127.0.0.1:2001:x 127.0.0.1:2000:x, "
		"5: 127.0.0.1:2001:123456789ax 127.0.0.1:2000:123456789ax 127.0.0.1:2001:123456x 127.0.0.1:2000:123456x 127.0.0.1:2001:x 127.0.0.1:2000:x",
	},
};

#if 1
static rm_test_t2 t2[] = {
	{
		"0000000000000000000000000000000000000000000000000000000000000000",
		1,
		"127.0.0.1:2001:00x 127.0.0.1:2000:00x 127.0.0.1:2001:x 127.0.0.1:2000:x",
	},
	{
		"0b00000000000000000000000000000000000000000000000000000000000000",
		1,
		"127.0.0.1:2001:x 127.0.0.1:2000:x",
	},
	{
		"bb00000000000000000000000000000000000000000000000000000000000000",
		1,
		"127.0.0.1:2001:bbx 127.0.0.1:2000:bbx 127.0.0.1:2001:x 127.0.0.1:2000:x",
	},
	{
		"123456789a000000000000000000000000000000000000000000000000000000",
		1,
		"127.0.0.1:2001:123456789ax 127.0.0.1:2000:123456789ax 127.0.0.1:2001:123456x 127.0.0.1:2000:123456x 127.0.0.1:2001:x 127.0.0.1:2000:x",
	},
};
#endif


#if 1
static rm_test_t2 t2_2[] = {
	{
		"0000000000000000000000000000000000000000000000000000000000000000",
		0,
		"",
	},
	{
		"0b00000000000000000000000000000000000000000000000000000000000000",
		0,
		"",
	},
	{
		"bb00000000000000000000000000000000000000000000000000000000000000",
		0,
		"",
	},
	{
		"123456789a000000000000000000000000000000000000000000000000000000",
		0,
		"",
	},
};
#endif

STATIC int
range_map_test_drive2(rm_test_t2 * t, int n)	{
	char dumpbuf[4096];
	hash_t hash;
	void * list;
	int i;
	int r;

	for (i = 0; i < n; i ++)	{

		r = hash_str_2_bin((unsigned char *)hash.buf, t[i].hash_string, strlen(t[i].hash_string));
		if (r)	{
			printf("Range map test failed, failed to translate hash string\n");
			return -1;
		}

		list = range_map_find_and_lock("kcdb", &hash);

		if (t[i].has_hash)	{
			if (list)	{
				;
			}
			else	{
				range_map_unlock();
				printf("hash list checking failed - %d\n", i);
				printf("Range map reading test -- FAIL\n");
				return -1;
			}
		}

		if (list)	{
			range_map_dump_list_to_buffer(dumpbuf, sizeof(dumpbuf), list);
			range_map_unlock();

			if (strcmp(dumpbuf, t[i].list_string))	{
				printf("test case %d: dump string missmatched\n", i);
				printf("Range map reading test -- FAIL\n");
				return -1;
			}
		}
	}

	printf("Range map reading test -- PASS\n");
	return 0;
}

void
range_map_test_0(void)	{
	char dumpbuf[4096];
	char errbuf[1024];
	int errlen;
	int i;
	int r;

	#define RM_CREATE_CMD "RangeMapNew(\"kcdb\");"
	esq_mkc_execute(RM_CREATE_CMD, sizeof(RM_CREATE_CMD) - 1, errbuf, &errlen);

	for (i = 0; i < (sizeof(t) / sizeof(t[0])); i ++)	{
		//printf("## %d ##: %s\n", i, t[i].cfg);
		errlen = sizeof(errbuf);
		r = esq_mkc_execute(t[i].cfg, strlen(t[i].cfg), errbuf, &errlen);
		if (r == t[i].r)	{
			if (r)	{
				continue;
			}
		}
		else	{
			printf("test case %d: return number is not %d, is %d\n", i, t[i].r, r);
			printf("error message: [%s]\n", errbuf);
			printf("Range map filling test -- FAIL\n");
			return;
		}

		range_map_dump_to_buffer("kcdb", dumpbuf, sizeof(dumpbuf));
		if (strcmp(dumpbuf, t[i].dump))	{
			printf("test case %d: dump string missmatched\n", i);
			printf("expecting: [%s]\n", t[i].dump);
			printf("output: [%s]\n", dumpbuf);
			printf("Range map filling test -- FAIL\n");
			return;
		}
	}

	printf("Range map filling test -- PASS\n");

	r = range_map_test_drive2(t2, (sizeof(t2) / sizeof(t2[0])));
	if (r)	{
		return;
	}

	#define RM_CLEAN_CMD "RangeMapDelAllNode(\"kcdb\");"
	esq_mkc_execute(RM_CLEAN_CMD, sizeof(RM_CLEAN_CMD) - 1, errbuf, &errlen);

	range_map_test_drive2(t2_2, (sizeof(t2_2) / sizeof(t2_2[0])));

	return;
}

/* eof */
